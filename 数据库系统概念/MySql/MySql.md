# 基础

## DDL 

### 数据库操作

``` sql
show databases ; // 查询所有数据库
select database() ;  // 查询当前数据库
create database [if not exists] 数据库名字 [default charset 字符集] [collate 排序规则] ;  // 创建数据库
drop database [if exists] 数据库名字 ;  // 删除数据库
use 数据库名字 ; // 使用数据库，切换数据库
```

### 二维表操作

```sql
show tables ; // 查询当前数据库的所有表
desc 表名 ;  // 查询表结构
show create table 表名 ;  // 查询指定表的建表语句
alter table 表名 rename to 新表名 ; // 修改表名
drop table [if exists] 表名 ; // 删除表
truncate table 表名 ; // 删除指定表，并重新创建该表

create table 表名(
	id int [comment '注释'],
    name varchar(50),
    age int,
    gender varchar(1)
) [comment 表注释] ;

show create table 表名 ; // 显示注释
```

``` sql
alter table 表名 add 字段名 类型 [comment 注释] ;  // 增加属性
alter table 表名 modify 字段名 新数据类型 ; // 修改数据类型
alter table 表名 change 旧字段名 新字段名 型数据类型 [comment 注释] [约束] ;  // 修改字段名和字段类型
alter table 表名 drop 字段名 ; 删除字段
```

## DML

```sql
 insert into 表名(字段1， 字段2) values(值1, 值2) ; // 添加数据
 insert into 表名 values(值1, 值2) ; // 添加数据
 insert into 表名(字段名1，字段名2) values(值1，值2)(值1，值2) ; // 添加多组数据
 insert into 表名 values(值1，值2)(值1，值2)(值1，值2) ; // 添加多组数据
```

```sql
update 表名 set 字段名1=值1， 字段名2=值2 [where 条件]
```

```sql
delete from 表名 [where 条件]
```



## DQL

```sql
select 
	字段列表[as]
from
	表名列表[as]
where
	条件列表
group by
	分组字段列表
having
	分组后条件列表
order by
	排序字段列表(asc 升序)(desc 降序)
limit
	分页参数(起始索引编号，每页的长度)
```

```sql
distinct 字段名 ; // 去除重复记录
```

![屏幕截图 2023-03-16 160543](MySql.assets/屏幕截图 2023-03-16 160543.png)

![屏幕截图 2023-03-16 161839](MySql.assets/屏幕截图 2023-03-16 161839.png)

![屏幕截图 2023-03-16 164439](MySql.assets/屏幕截图 2023-03-16 164439.png)

## DCL

```sql
use mysql ; select * from user ; // 查询有多少用户
// 主机名写 % 是可以在任意主机登录
create user '用户名'@'主机名' identified by '密码' ; // 创建用户
alter user '用户名'@'主机名' identified with mysql_native_password by '密码' ;  // 修改用户密码
drop user '用户名'@'主机名' ; // 删除用户
```

![屏幕截图 2023-03-16 181353](MySql.assets/屏幕截图 2023-03-16 181353.png)

```sql
show grants for '用户名'@'主机名' ;  // 查询权限
grant 权限列表 on 数据库名.表名 to '用户名'@'主机名' ; // 授予权限
revoke 权限列表 on 数据库名.表名 from '用户名'@'主机名' ;  // 撤销权限,可以用*，如*.*
```

## 函数

### 字符串函数

![屏幕截图 2023-03-16 181931](MySql.assets/屏幕截图 2023-03-16 181931.png)

```sql
select concat(name, age) ;
select lower(name) ;
select upper(name) ;
select lpad(name, 10, '-') ;
select rpad(name, 10, '-') ;
select trim(name) ;
select substring(name, 1, 3) ;
```

### 数值函数

![屏幕截图 2023-03-16 183043](MySql.assets/屏幕截图 2023-03-16 183043.png)

```sql
select ceil(age) ;
select floor(age) ;
select mod(x, y) ;
select rand() ;
select round(x, y) ;
```

### 日期函数

![屏幕截图 2023-04-02 150838](MySql.assets/屏幕截图 2023-04-02 150838.png)

### 流程函数

![屏幕截图 2023-04-02 151321](MySql.assets/屏幕截图 2023-04-02 151321.png)

## 约束

![屏幕截图 2023-04-02 151931](MySql.assets/屏幕截图 2023-04-02 151931.png)

![屏幕截图 2023-04-02 153140](MySql.assets/屏幕截图 2023-04-02 153140.png)

例子：

![屏幕截图 2023-04-02 152320](MySql.assets/屏幕截图 2023-04-02 152320.png)

外键约束的更新删除行为：
![屏幕截图 2023-04-02 153542](MySql.assets/屏幕截图 2023-04-02 153542.png)

## 多表查询

###  自然连接

```sql
select 字段列表 from 表1 nature join where 表2 ;
```



### 内连接

![屏幕截图 2023-04-02 155441](MySql.assets/屏幕截图 2023-04-02 155441.png)

### 外连接

![屏幕截图 2023-04-02 155759](MySql.assets/屏幕截图 2023-04-02 155759.png)

全外连接

```sql
full [nature] join ; // 外连接也都可以加nature,去除相同的
```

### 子查询

#### 标量子查询

![屏幕截图 2023-04-02 160927](MySql.assets/屏幕截图 2023-04-02 160927.png)

例子：![屏幕截图 2023-04-02 161247](MySql.assets/屏幕截图 2023-04-02 161247.png)

#### 列子查询

![屏幕截图 2023-04-02 161451](MySql.assets/屏幕截图 2023-04-02 161451.png)

例子：

![屏幕截图 2023-04-02 161908](MySql.assets/屏幕截图 2023-04-02 161908.png)

![屏幕截图 2023-04-02 161949](MySql.assets/屏幕截图 2023-04-02 161949.png)

#### 行子查询

![屏幕截图 2023-04-02 162109](MySql.assets/屏幕截图 2023-04-02 162109.png)

例子：

![屏幕截图 2023-04-02 162220](MySql.assets/屏幕截图 2023-04-02 162220.png)

#### 表子查询

![屏幕截图 2023-04-02 162245](MySql.assets/屏幕截图 2023-04-02 162245.png)

例子：

![屏幕截图 2023-04-02 162405](MySql.assets/屏幕截图 2023-04-02 162405.png)

![屏幕截图 2023-04-02 162500](MySql.assets/屏幕截图 2023-04-02 162500.png)

## 事务

### 事务操作

![屏幕截图 2023-04-02 165402](MySql.assets/屏幕截图 2023-04-02 165402.png)

![屏幕截图 2023-04-02 165144](MySql.assets/屏幕截图 2023-04-02 165144.png)

例子：![屏幕截图 2023-04-02 165310](MySql.assets/屏幕截图 2023-04-02 165310.png)

### 事务特性

![屏幕截图 2023-04-02 165527](MySql.assets/屏幕截图 2023-04-02 165527.png)

### 共发事务问题

![屏幕截图 2023-04-02 165711](MySql.assets/屏幕截图 2023-04-02 165711.png)

### 事务的隔离级别

![屏幕截图 2023-04-02 170027](MySql.assets/屏幕截图 2023-04-02 170027.png)

# 进阶

## 存储引擎

### 简介与创建

![屏幕截图 2023-04-02 172455](MySql.assets/屏幕截图 2023-04-02 172455.png)

### 存储引擎的特点

![屏幕截图 2023-04-02 172553](MySql.assets/屏幕截图 2023-04-02 172553.png)

![屏幕截图 2023-04-02 172813](MySql.assets/屏幕截图 2023-04-02 172813.png)

![屏幕截图 2023-04-02 173038](MySql.assets/屏幕截图 2023-04-02 173038.png)

![屏幕截图 2023-04-02 173205](MySql.assets/屏幕截图 2023-04-02 173205.png)

### 存储引擎的选择

![屏幕截图 2023-04-02 173435](MySql.assets/屏幕截图 2023-04-02 173435.png)

## 索引

### 索引概述

![屏幕截图 2023-04-02 183839](MySql.assets/屏幕截图 2023-04-02 183839.png)

![屏幕截图 2023-04-02 184029](MySql.assets/屏幕截图 2023-04-02 184029.png)

### 索引结构

![屏幕截图 2023-04-02 184128](MySql.assets/屏幕截图 2023-04-02 184128.png)

![屏幕截图 2023-04-02 184157](MySql.assets/屏幕截图 2023-04-02 184157.png)

**B-Tree**

![屏幕截图 2023-04-02 184416](MySql.assets/屏幕截图 2023-04-02 184416.png)

**B+Tree**

![屏幕截图 2023-04-02 184908](MySql.assets/屏幕截图 2023-04-02 184908.png)

**mysql中的B+Tree**

![屏幕截图 2023-04-02 185157](MySql.assets/屏幕截图 2023-04-02 185157.png)

**Hash**

![屏幕截图 2023-04-02 185349](MySql.assets/屏幕截图 2023-04-02 185349.png)

**原因**

![屏幕截图 2023-04-02 185542](MySql.assets/屏幕截图 2023-04-02 185542.png)

### 索引分类

![屏幕截图 2023-04-02 190506](MySql.assets/屏幕截图 2023-04-02 190506.png)

![屏幕截图 2023-04-02 190607](MySql.assets/屏幕截图 2023-04-02 190607.png)

**思考题：**

![屏幕截图 2023-04-02 192448](MySql.assets/屏幕截图 2023-04-02 192448.png)

### 索引语法

![屏幕截图 2023-04-02 193220](MySql.assets/屏幕截图 2023-04-02 193220.png)

## 视图

### 介绍和语法

![屏幕截图 2023-04-02 193938](MySql.assets/屏幕截图 2023-04-02 193938.png)

![屏幕截图 2023-04-02 194324](MySql.assets/屏幕截图 2023-04-02 194324.png)

### 视图检查

![屏幕截图 2023-04-03 200638](MySql.assets/屏幕截图 2023-04-03 200638.png)

![屏幕截图 2023-04-03 201054](MySql.assets/屏幕截图 2023-04-03 201054.png)

## 存储过程

### 介绍

![屏幕截图 2023-04-03 201933](MySql.assets/屏幕截图 2023-04-03 201933.png)

### 创建与调用

![屏幕截图 2023-04-03 202033](MySql.assets/屏幕截图 2023-04-03 202033.png)

![屏幕截图 2023-04-03 203824](MySql.assets/屏幕截图 2023-04-03 203824.png)

### 查看与删除

![屏幕截图 2023-04-03 202147](MySql.assets/屏幕截图 2023-04-03 202147.png)

### 系统变量

![屏幕截图 2023-04-03 202621](MySql.assets/屏幕截图 2023-04-03 202621.png)

### 用户变量

![屏幕截图 2023-04-03 202908](MySql.assets/屏幕截图 2023-04-03 202908.png)

### 局部变量

![屏幕截图 2023-04-03 203251](MySql.assets/屏幕截图 2023-04-03 203251.png)

### if

![屏幕截图 2023-04-03 203336](MySql.assets/屏幕截图 2023-04-03 203336.png)

### case

![屏幕截图 2023-04-03 204218](MySql.assets/屏幕截图 2023-04-03 204218.png)

**例子：**

![屏幕截图 2023-04-03 211907](MySql.assets/屏幕截图 2023-04-03 211907.png)

### while

![屏幕截图 2023-04-03 204548](MySql.assets/屏幕截图 2023-04-03 204548.png)

### repeat

![屏幕截图 2023-04-03 204709](MySql.assets/屏幕截图 2023-04-03 204709.png)

### loop

![屏幕截图 2023-04-03 204901](MySql.assets/屏幕截图 2023-04-03 204901.png)

**例子：**

![屏幕截图 2023-04-03 205442](MySql.assets/屏幕截图 2023-04-03 205442.png)

### 游标

![屏幕截图 2023-04-03 205924](MySql.assets/屏幕截图 2023-04-03 205924.png)

![屏幕截图 2023-04-03 211211](MySql.assets/屏幕截图 2023-04-03 211211.png)

**例子：**

![屏幕截图 2023-04-03 211312](MySql.assets/屏幕截图 2023-04-03 211312.png)

![屏幕截图 2023-04-03 211323](MySql.assets/屏幕截图 2023-04-03 211323.png)

### 存储函数

![屏幕截图 2023-04-03 213227](MySql.assets/屏幕截图 2023-04-03 213227.png)

**例子：**

![屏幕截图 2023-04-03 213515](MySql.assets/屏幕截图 2023-04-03 213515.png)

## 触发器

![屏幕截图 2023-04-03 213857](MySql.assets/屏幕截图 2023-04-03 213857.png)

![屏幕截图 2023-04-03 213938](MySql.assets/屏幕截图 2023-04-03 213938.png)

**例子：**

![屏幕截图 2023-04-03 214315](MySql.assets/屏幕截图 2023-04-03 214315.png)
